<!DOCTYPE html>
<html class="dark" lang="es">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Confirmar Pedido - Tierra Querida</title>

    <!-- ✅ Forzar SIEMPRE dark -->
    <script>
      (function () {
        const root = document.documentElement;
        const forceDark = () => {
          if (!root.classList.contains("dark")) root.classList.add("dark");
        };
        forceDark();
        const obs = new MutationObserver(forceDark);
        obs.observe(root, { attributes: true, attributeFilter: ["class"] });
      })();
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
      rel="stylesheet"
    />

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#e02424",
              "background-light": "#f8f6f6",
              "background-dark": "#171111",
              "surface-dark": "#261c1c",
              "surface-dark-hover": "#3a2a2a",
              whatsapp: "#25D366",
            },
            fontFamily: { display: ["Plus Jakarta Sans", "sans-serif"] },
            borderRadius: {
              DEFAULT: "1rem",
              lg: "1.5rem",
              xl: "2rem",
              "2xl": "2.5rem",
              full: "9999px",
            },
          },
        },
      };
    </script>

    <style>
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      html {
        scroll-behavior: smooth;
      }
    </style>

    <link rel="stylesheet" href="/styles.css" />
  </head>

  <body
    class="bg-background-light dark:bg-background-dark text-gray-900 dark:text-white font-display overflow-x-hidden selection:bg-primary selection:text-white"
  >
    <div class="relative flex h-auto min-h-screen w-full flex-col">
      <!-- Header -->
      <header
        class="sticky top-0 z-50 w-full backdrop-blur-md bg-white/80 dark:bg-[#171111]/80 border-b border-[#382929]"
      >
        <div
          class="max-w-[1440px] mx-auto px-6 lg:px-12 py-4 flex items-center justify-between gap-6"
        >
          <div class="flex items-center gap-3">
            <a
              class="flex items-center gap-3 hover:opacity-80 transition-opacity"
              href="/"
            >
              <div
                class="size-10 bg-primary rounded-full flex items-center justify-center text-white"
              >
                <span class="material-symbols-outlined">lunch_dining</span>
              </div>
              <h2 class="text-xl font-bold tracking-tight hidden sm:block">
                Tierra Querida
              </h2>
            </a>
          </div>

          <nav class="hidden md:flex items-center gap-8">
            <a
              class="text-sm font-bold hover:text-primary transition-colors"
              href="/#products-section"
              >Menú</a
            >
            <a
              class="text-sm font-bold hover:text-primary transition-colors"
              href="/#about-section"
              >Nosotros</a
            >
            <a
              class="text-sm font-bold hover:text-primary transition-colors"
              href="/#main-footer"
              >Contacto</a
            >
          </nav>

          <div class="flex items-center gap-4 flex-1 justify-end md:flex-none">
            <button
              class="p-2 hover:bg-surface-dark rounded-full transition-colors hidden sm:block"
              aria-label="Perfil"
              onclick="window.location.href='/login'"
            >
              <span class="material-symbols-outlined">person</span>
            </button>

            <button
              class="relative flex items-center gap-2 bg-primary hover:bg-red-700 text-white px-4 h-10 rounded-full transition-all group"
              aria-label="Carrito"
              onclick="window.location.href='/cart'"
            >
              <span class="material-symbols-outlined text-[20px]"
                >shopping_bag</span
              >
              <span
                id="cart-badge-desktop"
                class="font-bold text-sm hidden sm:block"
                >0</span
              >
              <span
                id="cart-badge-mobile"
                class="absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-white text-[10px] font-bold text-primary sm:hidden"
                >0</span
              >
            </button>
          </div>
        </div>
      </header>

      <main
        class="flex-1 w-full max-w-[1440px] mx-auto px-6 lg:px-12 py-8 flex flex-col gap-8"
      >
        <div class="flex items-center gap-3">
          <button
            id="confirm-back-button"
            type="button"
            class="p-2 rounded-full bg-surface-dark hover:bg-surface-dark-hover transition-colors text-white"
            aria-label="Volver"
          >
            <span class="material-symbols-outlined">arrow_back</span>
          </button>

          <div class="flex flex-col gap-1">
            <h1 class="text-3xl md:text-4xl font-extrabold">
              Confirmar Pedido
            </h1>
            <p class="text-gray-500 dark:text-gray-400">
              Completa tus datos para finalizar tu orden.
            </p>
          </div>
        </div>

        <!-- Aviso no logueado -->
        <div
          id="no-user-warning"
          class="hidden bg-blue-500/10 border border-blue-500/20 text-blue-600 dark:text-blue-400 rounded-2xl p-4 flex items-start gap-3"
        >
          <span class="material-symbols-outlined mt-0.5">info</span>
          <div>
            <p class="font-bold">¿Ya tienes cuenta?</p>
            <p class="text-sm">
              Inicia sesión para cargar tus datos guardados.
              <a class="underline hover:text-blue-500 ml-1" href="/login"
                >Ingresar ahora</a
              >
            </p>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
          <!-- Col izquierda -->
          <div class="lg:col-span-7 flex flex-col gap-8">
            <!-- Datos del cliente -->
            <section
              class="bg-white dark:bg-surface-dark rounded-3xl p-6 md:p-8 shadow-sm border border-gray-100 dark:border-[#382929]"
            >
              <div
                class="flex items-center gap-3 mb-6 border-b border-gray-100 dark:border-[#382929] pb-4"
              >
                <div
                  class="size-10 rounded-full bg-primary/10 text-primary flex items-center justify-center"
                >
                  <span class="material-symbols-outlined">person</span>
                </div>
                <h2 class="text-xl font-bold">Datos del Cliente</h2>
              </div>

              <!-- ✅ CAMBIO: en pantallas pequeñas todo 1 columna, y desde sm 2 columnas -->
              <div
                class="grid grid-cols-1 sm:grid-cols-2 gap-4 min-w-0"
              >
                <div class="col-span-1 sm:col-span-2">
                  <label
                    class="block text-xs font-bold uppercase text-gray-500 mb-1"
                    >Nombre Completo</label
                  >
                  <input
                    id="client-name"
                    class="w-full min-w-0 bg-background-light dark:bg-background-dark border-transparent focus:border-primary focus:ring-0 rounded-xl px-4 py-3 text-base md:text-sm font-medium transition-colors"
                    placeholder="Ej. Juan Pérez"
                    type="text"
                  />
                </div>

                <!-- ✅ Teléfono 100% en móvil -->
                <div class="col-span-1">
                  <label
                    class="block text-xs font-bold uppercase text-gray-500 mb-1"
                    >Teléfono</label
                  >
                  <input
                    id="client-phone"
                    class="w-full min-w-0 bg-background-light dark:bg-background-dark border-transparent focus:border-primary focus:ring-0 rounded-xl px-4 py-3 text-base md:text-sm font-medium transition-colors"
                    placeholder="+57 300 123 4567"
                    type="tel"
                    inputmode="tel"
                  />
                  <p
                    id="phone-error"
                    class="mt-2 text-xs text-red-400 hidden"
                  >
                    El número debe comenzar con +57 y tener 10 dígitos después
                    del prefijo.
                  </p>
                </div>

                <!-- ✅ CAMBIO: Email baja en móvil (porque grid-cols-1) y en sm vuelve a 2 cols -->
                <div class="col-span-1">
                  <label
                    class="block text-xs font-bold uppercase text-gray-500 mb-1"
                    >Email</label
                  >
                  <input
                    id="client-email"
                    class="w-full min-w-0 bg-background-light dark:bg-background-dark border-transparent focus:border-primary focus:ring-0 rounded-xl px-4 py-3 text-base md:text-sm font-medium transition-colors"
                    placeholder="hola@correo.com"
                    type="email"
                    inputmode="email"
                    autocomplete="email"
                  />
                  <p
                    id="email-error"
                    class="mt-2 text-xs text-red-400 hidden"
                  >
                    Ingresa un correo válido.
                  </p>
                </div>

                <div class="col-span-1 sm:col-span-2">
                  <label
                    class="block text-xs font-bold uppercase text-gray-500 mb-1"
                    >Dirección de Entrega</label
                  >
                  <div class="relative min-w-0">
                    <span
                      class="material-symbols-outlined absolute left-4 top-3 text-gray-400"
                      >location_on</span
                    >
                    <input
                      id="client-address"
                      class="w-full min-w-0 bg-background-light dark:bg-background-dark border-transparent focus:border-primary focus:ring-0 rounded-xl pl-12 pr-4 py-3 text-base md:text-sm font-medium transition-colors"
                      placeholder="Calle 123 # 45 - 67, Apto 201"
                      type="text"
                      autocomplete="street-address"
                    />
                  </div>
                </div>

                <!-- ✅ Método de pago -->
                <div class="col-span-1 sm:col-span-2">
                  <label
                    class="block text-xs font-bold uppercase text-gray-500 mb-1"
                    >Método de pago</label
                  >
                  <select
                    id="payment-method"
                    class="w-full min-w-0 bg-background-light dark:bg-background-dark border-transparent focus:border-primary focus:ring-0 rounded-xl px-4 py-3 text-base md:text-sm font-medium transition-colors cursor-pointer"
                  >
                    <option value="">Selecciona un método</option>
                    <option value="Efectivo">Efectivo</option>
                    <option value="Transferencia Bancolombia">
                      Transferencia Bancolombia
                    </option>
                    <option value="Tarjeta / Datafono">
                      Tarjeta / Datáfono
                    </option>
                    <option value="Nequi / Daviplata">Nequi / Daviplata</option>
                  </select>
                  <p
                    id="payment-error"
                    class="mt-2 text-xs text-red-400 hidden"
                  >
                    Selecciona un método de pago.
                  </p>
                </div>

                <div class="col-span-1 sm:col-span-2">
                  <label
                    class="block text-xs font-bold uppercase text-gray-500 mb-1"
                    >Instrucciones Adicionales</label
                  >
                  <textarea
                    id="client-notes"
                    class="w-full min-w-0 bg-background-light dark:bg-background-dark border-transparent focus:border-primary focus:ring-0 rounded-xl px-4 py-3 text-base md:text-sm font-medium transition-colors resize-none"
                    placeholder="Ej. Dejar en portería, timbre roto..."
                    rows="2"
                  ></textarea>
                </div>
              </div>
            </section>

            <!-- Punto de venta -->
            <section
              class="bg-white dark:bg-surface-dark rounded-3xl p-6 md:p-8 shadow-sm border border-gray-100 dark:border-[#382929]"
            >
              <div
                class="flex items-center justify-between gap-3 mb-6 border-b border-gray-100 dark:border-[#382929] pb-4"
              >
                <div class="flex items-center gap-3">
                  <div
                    class="size-10 rounded-full bg-primary/10 text-primary flex items-center justify-center"
                  >
                    <span class="material-symbols-outlined">storefront</span>
                  </div>
                  <h2 class="text-xl font-bold">Punto de Venta</h2>
                </div>

                <button
                  id="suggest-pv-btn"
                  type="button"
                  class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-primary text-white text-xs font-extrabold hover:bg-red-700 transition-colors"
                >
                  <span class="material-symbols-outlined text-[18px]"
                    >my_location</span
                  >
                  Usar cercano
                </button>
              </div>

              <p
                id="pv-message"
                class="text-sm text-gray-500 dark:text-gray-400"
              >
                Selecciona tu sucursal. Si cambias el punto de venta, usa
                “Actualizar mensaje” para regenerar el texto de WhatsApp.
              </p>

              <div
                id="pv-card"
                class="hidden mt-5 rounded-2xl border border-[#382929] bg-background-dark/30 p-4"
              >
                <p id="pv-name" class="font-extrabold text-white"></p>
                <p id="pv-address" class="text-sm text-gray-300 mt-1"></p>
                <p id="pv-whatsapp" class="text-sm text-gray-300 mt-1"></p>
                <p class="text-xs text-gray-500 mt-3">
                  Este WhatsApp será el destino del mensaje y el punto de venta
                  del pedido.
                </p>
              </div>

              <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-3">
                <select
                  id="pv-departamento"
                  class="w-full min-w-0 bg-background-light dark:bg-background-dark border border-transparent focus:border-primary focus:ring-0 rounded-xl px-4 py-3 text-base md:text-sm font-medium transition-colors cursor-pointer"
                >
                  <option value="">Departamento</option>
                </select>

                <select
                  id="pv-municipio"
                  class="w-full min-w-0 bg-background-light dark:bg-background-dark border border-transparent focus:border-primary focus:ring-0 rounded-xl px-4 py-3 text-base md:text-sm font-medium transition-colors cursor-pointer"
                  disabled
                >
                  <option value="">Municipio</option>
                </select>

                <select
                  id="pv-barrio"
                  class="w-full min-w-0 bg-background-light dark:bg-background-dark border border-transparent focus:border-primary focus:ring-0 rounded-xl px-4 py-3 text-base md:text-sm font-medium transition-colors cursor-pointer"
                  disabled
                >
                  <option value="">Barrio</option>
                </select>
              </div>
            </section>
          </div>

          <!-- Col derecha -->
          <div class="lg:col-span-5 relative">
            <div class="sticky top-24 flex flex-col gap-6">
              <section
                class="bg-whatsapp/10 border border-whatsapp/20 rounded-3xl p-6 md:p-8 relative overflow-hidden"
              >
                <div class="flex items-center justify-between mb-4">
                  <div class="flex items-center gap-3">
                    <div
                      class="size-10 rounded-full bg-whatsapp text-white flex items-center justify-center shadow-lg shadow-whatsapp/30"
                    >
                      <span class="material-symbols-outlined">chat</span>
                    </div>
                    <h2 class="text-xl font-bold text-gray-900 dark:text-white">
                      Tu Pedido
                    </h2>
                  </div>
                  <span
                    class="text-xs font-bold bg-white dark:bg-background-dark px-3 py-1 rounded-full text-whatsapp border border-whatsapp/30"
                    >WhatsApp</span
                  >
                </div>

                <div
                  class="bg-white dark:bg-background-dark rounded-xl border border-gray-200 dark:border-gray-700 p-4 shadow-sm mb-6"
                >
                  <label
                    class="block text-xs font-bold uppercase text-gray-400 mb-2"
                    >Mensaje a enviar:</label
                  >
                  <textarea
                    id="order-text"
                    class="w-full h-56 bg-transparent border-none p-0 text-sm leading-relaxed text-gray-600 dark:text-gray-300 focus:ring-0 resize-none font-mono"
                  ></textarea>

                  <div
                    class="mt-2 pt-3 border-t border-gray-100 dark:border-gray-800 flex justify-between items-center"
                  >
                    <span class="text-xs text-gray-400"
                      >Se abrirá WhatsApp Web/App</span
                    >
                    <button
                      id="refresh-message-btn"
                      type="button"
                      class="text-xs font-bold text-primary hover:underline"
                    >
                      Actualizar mensaje
                    </button>
                  </div>
                </div>

                <button
                  id="send-whatsapp-btn"
                  type="button"
                  class="w-full bg-whatsapp hover:bg-[#1DA851] text-white font-bold py-4 px-6 rounded-xl shadow-lg shadow-whatsapp/30 flex items-center justify-center gap-3 transition-all transform hover:-translate-y-1 hover:shadow-xl group disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:translate-y-0"
                  disabled
                >
                  <span
                    class="material-symbols-outlined group-hover:animate-bounce"
                    >send</span
                  >
                  Enviar Pedido por WhatsApp
                </button>

                <p class="text-center text-xs text-gray-500 mt-4 px-4">
                  Al hacer clic, serás redirigido a WhatsApp para enviar el
                  mensaje y coordinar el pago.
                </p>
              </section>

              <div class="bg-surface-dark rounded-3xl p-6 text-center">
                <h3 class="font-bold text-white mb-2">¿Necesitas ayuda?</h3>
                <p class="text-sm text-gray-400 mb-4">
                  Llámanos directamente si tienes problemas con tu pedido.
                </p>
                <a
                  class="inline-flex items-center gap-2 text-white font-bold border border-gray-600 hover:bg-gray-700 px-4 py-2 rounded-full text-sm transition-colors"
                  href="tel:+1234567890"
                >
                  <span class="material-symbols-outlined text-sm">call</span>
                  Llamar al soporte
                </a>
              </div>
            </div>
          </div>
        </div>
      </main>

      <footer class="bg-surface-dark border-t border-[#382929] py-10">
        <div
          class="max-w-[1440px] mx-auto px-6 lg:px-12 flex flex-col md:flex-row items-center justify-between gap-4 text-xs text-gray-500"
        >
          <p>© 2025 Tierra Querida. Todos los derechos reservados.</p>
          <div class="flex gap-4">
            <span class="cursor-pointer hover:text-white">Facebook</span>
            <span class="cursor-pointer hover:text-white">Instagram</span>
            <span class="cursor-pointer hover:text-white">Twitter</span>
          </div>
        </div>
      </footer>
    </div>

    <script type="module" src="/confirm.js"></script>
  </body>
</html>
